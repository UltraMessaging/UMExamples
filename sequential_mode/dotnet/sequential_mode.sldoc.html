<html>
  <head>
    <link rel="stylesheet" href="../../style/main.css" type="text/css" media="screen" />
    <title>Logging Callback</title>
  </head>
  <body>
    <a href="../../index.html" class="button" target="_top">Example index</a>
    <h1>Sequential Mode Example</h1>
    <p>In this example, the sample below shows how to simply configure an Ultra Messaging application how to configure and run
    in the "sequential" mode of operation.</p>
    <p>When you create a context (lbm_context_create()) with the 
    <a href="#" title="The mode in which UM operates to process events. Refer to Embedded and Sequential Mode for additional information.

Scope:	context
Type:	int
When to Set:	Can only be set during object initialization.
String value	Integer value	Description
embedded	LBM_CTX_ATTR_OP_EMBEDDED	A thread is spawned within UM to handle processing of events (timers and socket events). Default for all.
sequential	LBM_CTX_ATTR_OP_SEQUENTIAL	The application is responsible for calling lbm_context_process_events() to process events. Sequential mode does not support Multi-Transport Threads.
" style="color:2222ee;border-bottom:1px dotted #2222ee;text-decoration: none;">operational_mode</a>
set to sequential, the context thread is NOT 
    created. It becomes the application's responsibility to donate a thread to UM by calling lbm_context_process_events() 
    regularly, typically in a tight loop. Use Sequential mode for circumstances where your application wants control over the 
    attributes of the context thread. For example, some applications raise the priority of the context thread so as to obtain more 
    consistent latencies. In sequential mode, no separate thread is spawned when a context is created.</p>
    <p><b>Important things to note when using sequential mode</b><ul>
      <li>Processing events consistently is a must - spending time on the thread processing events, outside of processing events, can 
          have undesirable effects on UM components (message loss, transport timeouts, message recovery, etc.)
      <li>Context event callbacks must still be processed in a timely manner for the same reason as above. For context level events
          that might possibly take time to process, consider using an event queue</li>
    </ul></p>
    <p>This example very simply sets the attirbute to enable sequential mode, spawns a thread that spins on processing context events,
    while the main application thread waits forever.</p>

    <p>There is one program source file:</p>
    <ul>
      <li><b><tt><a href="SequentialMode.cs">SequentialMode.cs</a></tt></b>
        - (right-click and save as "SequentialMode.cs") main program.</li>
    </ul>
    <h2>Program explanation: <tt>SequentialMode.cs</tt></h2>
    <h4>Initialize and Create Context</h4>
	<p>Standard API's to create a context object. The important thing to note here is the fact that the 
	<a href="#" title="The mode in which UM operates to process events. Refer to Embedded and Sequential Mode for additional information.

Scope:	context
Type:	int
When to Set:	Can only be set during object initialization.
String value	Integer value	Description
embedded	LBM_CTX_ATTR_OP_EMBEDDED	A thread is spawned within UM to handle processing of events (timers and socket events). Default for all.
sequential	LBM_CTX_ATTR_OP_SEQUENTIAL	The application is responsible for calling lbm_context_process_events() to process events. Sequential mode does not support Multi-Transport Threads.
" style="color:2222ee;border-bottom:1px dotted #2222ee;text-decoration: none;">operational_mode</a>
 is being set to "sequential".
	Setting the operational_mode is required to take advantage of the sequential mode of operation.</p>
	<a name="create_ref_1" id="create_ref_1"></a>
<small><pre>
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00015</a>                  /* Initialization: create necessary UM objects. */
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00016</a>                  try {
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00017</a>                          LBMContextAttributes ctxAttr = new LBMContextAttributes();
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00018</a>                          ctxAttr.setValue("operational_mode", "sequential");
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00019</a>                          ctx = new LBMContext(ctxAttr);
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00020</a>                  }
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00021</a>                  catch(LBMException ex)
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00022</a>                  {
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00023</a>                          System.Console.Error.WriteLine("Error initializing LBM objects: " + ex.Message);
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00024</a>                          System.Environment.Exit(1);
<a href="sequential_mode_dotnet.slsrc.html#create" target="src">00025</a>                  }
</pre><!-- endblock create_ref_1 --></small>


    <h4>Spawn a New Thread</h4>
	<p>In this example, the application spawns a new thread whose sole purpose will be to process context events. The 
	application could use this to set a higher thread priority, or possibly set the process affinity to offer better performance
	for message delivery. Notice the thread function is "seq_thread", which will be explained in the next block.</p>
	<a name="spawn_thread_ref_1" id="spawn_thread_ref_1"></a>
<small><pre>
<a href="sequential_mode_dotnet.slsrc.html#spawn_thread" target="src">00027</a>                  SeqThread ThreadHandler = new SeqThread(ctx);
<a href="sequential_mode_dotnet.slsrc.html#spawn_thread" target="src">00028</a>                  ThreadHandler.start();
</pre><!-- endblock spawn_thread_ref_1 --></small>


    <h4>Sequential Context Thread</h4>
	<p>Here is where the function is declared that will be the thread that processes context events. This function very simply
	calls the process events API, ensures there are no errors, and repeats. 
	<a name="context_thread_ref_1" id="context_thread_ref_1"></a>
<small><pre>
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00042</a>          public class SeqThread
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00043</a>          {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00044</a>                  private LBMContext _ctx;
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00045</a>                  private Thread myThread;
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00046</a>  
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00047</a>                  public SeqThread(LBMContext ctx)
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00048</a>                  {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00049</a>                          _ctx = ctx;
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00050</a>                  }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00051</a>  
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00052</a>                  public void start()
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00053</a>                  {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00054</a>                      myThread = new Thread(new ThreadStart(run));
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00055</a>                      myThread.Start();
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00056</a>                  }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00057</a>  
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00058</a>                  public void run()
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00059</a>                  {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00060</a>                          while (true)
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00061</a>                          {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00062</a>                                  try {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00063</a>                                      _ctx.processEvents(500);
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00064</a>                                  }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00065</a>                                  catch(LBMException ex)
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00066</a>                                  {
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00067</a>                                      System.Console.Error.WriteLine("Error processing context events: " + ex.Message);
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00068</a>                                      System.Environment.Exit(1);
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00069</a>                                  }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00070</a>                          }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00071</a>                  }
<a href="sequential_mode_dotnet.slsrc.html#context_thread" target="src">00072</a>          }
</pre><!-- endblock context_thread_ref_1 --></small>


  </body>
</html>

