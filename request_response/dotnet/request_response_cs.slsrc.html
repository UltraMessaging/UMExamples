<!DOCTYPE html><html><head><title>request_response.cs</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script>
  $(function() {
    $( document ).tooltip();
  });
</script>
<style>
#code {background-color:#ffffff;};
</style>
</head>
<body><h1>request_response.cs</h1>
<script>hljs.initHighlightingOnLoad();</script>
<small><pre><code id="code"><table border=0 cellpadding=0 cellspacing=0><tr>
<td>00001
00002
<a href="request_response.sldoc.html#import_ref_1" target="doc">00003</a>
<a href="request_response.sldoc.html#import_ref_1" target="doc">00004</a>
<a href="request_response.sldoc.html#import_ref_1" target="doc">00005</a>
<a href="request_response.sldoc.html#import_ref_1" target="doc">00006</a>
<a href="request_response.sldoc.html#import_ref_1" target="doc">00007</a>
00008
00009
00010
00011
00012
00013
00014
00015
<a href="request_response.sldoc.html#context_create_ref_1" target="doc">00016</a>
00017
00018
<a href="request_response.sldoc.html#init_cb_ref_1" target="doc">00019</a>
00020
00021
<a href="request_response.sldoc.html#create_rcv_ref_1" target="doc">00022</a>
<a href="request_response.sldoc.html#create_rcv_ref_1" target="doc">00023</a>
<a href="request_response.sldoc.html#create_rcv_ref_1" target="doc">00024</a>
00025
00026
<a href="request_response.sldoc.html#create_src_ref_1" target="doc">00027</a>
<a href="request_response.sldoc.html#create_src_ref_1" target="doc">00028</a>
00029
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00030</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00031</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00032</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00033</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00034</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00035</a>
<a href="request_response.sldoc.html#create_req_ref_1" target="doc">00036</a>
00037
00038
00039
00040
00041
00042
00043
00044
00045
00046
00047
00048
00049
<a href="request_response.sldoc.html#send_req_ref_1" target="doc">00050</a>
00051
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00052</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00053</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00054</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00055</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00056</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00057</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00058</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00059</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00060</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00061</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00062</a>
<a href="request_response.sldoc.html#loop_ref_1" target="doc">00063</a>
00064
00065
<a href="request_response.sldoc.html#clean_ref_1" target="doc">00066</a>
<a href="request_response.sldoc.html#clean_ref_1" target="doc">00067</a>
<a href="request_response.sldoc.html#clean_ref_1" target="doc">00068</a>
<a href="request_response.sldoc.html#clean_ref_1" target="doc">00069</a>
00070
00071
00072
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00073</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00074</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00075</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00076</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00077</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00078</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00079</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00080</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00081</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00082</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00083</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00084</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00085</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00086</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00087</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00088</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00089</a>
<a href="request_response.sldoc.html#send_response_ref_1" target="doc">00090</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00091</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00092</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00093</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00094</a>
<a href="request_response.sldoc.html#rcv_cb_ref_1" target="doc">00095</a>
00096
00097
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00098</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00099</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00100</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00101</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00102</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00103</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00104</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00105</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00106</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00107</a>
<a href="request_response.sldoc.html#resp_cb_ref_1" target="doc">00108</a>
00109
</td><td>  /* RequestResponse.cs, see http://ultramessaging.github.io/UMExamples/RequestResponse/dotnet/ */
  
<span name="import" id="import"></span>  using System;
  using System.Collections.Generic;
  using System.Text;
  using com.latencybusters.lbm;
  using System.Runtime.InteropServices;
  
  public class RequestResponse
  {
      public static int run = 1;
  
      public static void main(String[] args)
      {
          /* Initialization: create necessary UM objects. */
<span name="context_create" id="context_create"></span>          LBMContext ctx = new LBMContext();
  
          /* Create LBMReceiverCallback using the method onReceive defined in this class */
<span name="init_cb" id="init_cb"></span>          LBMReceiverCallback rcvCallback = new LBMReceiverCallback(onReceive);
  
          /* Create receiver objects */
<span name="create_rcv" id="create_rcv"></span>          LBMReceiverAttributes rcv_attr = new LBMReceiverAttributes();
          LBMTopic rtopic = new LBMTopic(ctx, "test.topic", rcv_attr);
          LBMReceiver rcv = new LBMReceiver(ctx, rtopic, rcvCallback, null, null);
  
          /* Initialize and create source */
<span name="create_src" id="create_src"></span>          LBMTopic stopic = new LBMTopic(ctx, "test.topic", new LBMSourceAttributes());
          LBMSource src = new LBMSource(ctx, stopic);
  
<span name="create_req" id="create_req"></span>          String msgData = "request";
          byte[] bytes = new byte[msgData.Length * sizeof(char)];
          System.Buffer.BlockCopy(msgData.ToCharArray(), 0, bytes, 0, bytes.Length);
  
          LBMRequest req = new LBMRequest(bytes, bytes.Length);
          LBMResponseCallback myResponseCallback = new LBMResponseCallback(onResponse);
          req.addResponseCallback(myResponseCallback);
  
          /* Sleep for 1 second to allow TR to complete */
          try
          {
              System.Threading.Thread.Sleep(1000);
          }
          catch (Exception ex)
          {
              System.Console.Error.WriteLine("Error System.Threading.Thread.Sleep() exception:  " + ex.Message);
              System.Environment.Exit(1);
          }
  
          /* Send a message. */
<span name="send_req" id="send_req"></span>          src.send(req, LBM.MSG_FLUSH | LBM.SRC_BLOCK);
  
<span name="loop" id="loop"></span>          while (run == 1)
          {
              try
              {
                  System.Threading.Thread.Sleep(1000);
              }
              catch (Exception ex)
              {
                  System.Console.Error.WriteLine("Error System.Threading.Thread.Sleep() exception:  " + ex.Message);
                  System.Environment.Exit(1);
              }
          }
  
          /* Cleanup: delete UM objects. */
<span name="clean" id="clean"></span>          req.close();
          src.close();
          rcv.close();
          ctx.close();
      }  /* main */
  
      /* Class for receiving messages */
<span name="rcv_cb" id="rcv_cb"></span>      static protected int onReceive(object cbArg, LBMMessage msg)
      {
          switch (msg.type())
          {
              case LBM.MSG_REQUEST:
                  {
                      System.Console.Out.Write("Request Received");
<span name="send_response" id="send_response"></span>                      try
                      {
                          String msgData = "response";
                          byte[] bytes = new byte[msgData.Length * sizeof(char)];
                          System.Buffer.BlockCopy(msgData.ToCharArray(), 0, bytes, 0, bytes.Length);
                          msg.respond(bytes, msgData.Length, LBM.SRC_NONBLOCK);
                      }
                      catch (LBMException ex)
                      {
                          System.Console.Out.Write("Error responding to request: " + ex.Message);
                      }
                  }
                  break;
          }
          return 0;
      }/* ReceiverCallback */
      
      /* Class for receiving responses */
<span name="resp_cb" id="resp_cb"></span>      public static int onResponse(object cbArg, LBMRequest req, LBMMessage msg)
      {
          switch (msg.type())
          {
              case LBM.MSG_RESPONSE:
                  System.Console.Out.WriteLine("Response Received");
                  run = 0;
                  break;
          }
          return 0;
      } /* ResponseCallback */
  } /* class RequestResponse */
</td></tr></table></code>




















































































</pre></small></body></html>
